<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Mon assistant de math√©matiques - niveau cycle d'orientation</title>

<script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
<script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
<script src="https://cdn.tailwindcss.com"></script>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/katex.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/katex.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/contrib/auto-render.min.js"></script>

<style>
* { box-sizing: border-box; margin: 0; padding: 0; }
html, body { height: 100%; overflow: hidden; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; }

body { background: #f9fafb; color: #111827; }
.chat-bg { background: #f9fafb; }
.card { background: #ffffff; border: 1px solid #e5e7eb; }
.user-msg { background: #000; color: #fff; }
.bot-msg { background: #fff; border: 1px solid #e5e7eb; }
.input-bar { background: #ffffff; border-top: 1px solid #e5e7eb; }

body.dark { background: #0f172a; color: #e5e7eb; }
body.dark .chat-bg { background: #0f172a; }
body.dark .card,
body.dark .bot-msg,
body.dark .input-bar {
  background: #020617;
  border-color: #1e293b;
  color: #e5e7eb;
}
body.dark input {
  background: #020617;
  color: #e5e7eb;
  border-color: #1e293b;
}

#input-bar {
  position: fixed;
  bottom: 0;
  left: 0;
  right: 0;
  height: auto;
  min-height: 72px;
  z-index: 100;
}

#chat-scroll {
  position: absolute;
  inset: 0 0 140px 0;
  overflow-y: auto;
  padding: 16px;
}

@media (min-width: 768px) {
  #chat-scroll {
    inset: 0 0 72px 0;
  }
}

.katex { font-size: 1.1em; }

/* Style pour le badge TAF */
.taf-badge {
  animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
}

@keyframes pulse {
  0%, 100% {
    opacity: 1;
  }
  50% {
    opacity: .7;
  }
}

.mode-indicator {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  padding: 4px 12px;
  border-radius: 9999px;
  font-size: 0.75rem;
  font-weight: 600;
}

.mode-taf {
  background: #dc2626;
  color: white;
}

.mode-normal {
  background: #3b82f6;
  color: white;
}
</style>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Les maths 1200</title>
	<link rel="stylesheet" type="text/css" href="style.css">
	<link rel="stylesheet" type="text/css" href="footer.css">
	<link rel="stylesheet" type="text/css" href="header.css">
</head>

<body>
<header></header>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
      $(function() {
        $("header").load("header.html");
      });
    </script>
	
<div id="root"></div>

<script type="text/babel">
const { useState, useEffect, useRef } = React;

/* Icons */
const SendIcon = () => (
<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
<line x1="22" y1="2" x2="11" y2="13"></line>
<polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
</svg>
);

const CalculatorIcon = () => (
<svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
<rect x="4" y="2" width="16" height="20" rx="2"></rect>
<line x1="8" y1="6" x2="16" y2="6"></line>
</svg>
);

const YoutubeIcon = () => (
<svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor">
<path d="M23.498 6.186a3.016 3.016 0 0 0-2.122-2.136C19.505 3.545 12 3.545 12 3.545s-7.505 0-9.377.505A3.017 3.017 0 0 0 .502 6.186C0 8.07 0 12 0 12s0 3.93.502 5.814a3.016 3.016 0 0 0 2.122 2.136c1.871.505 9.376.505 9.376.505s7.505 0 9.377-.505a3.015 3.015 0 0 0 2.122-2.136C24 15.93 24 12 24 12s0-3.93-.502-5.814z"/>
<path d="M9.545 15.568V8.432L15.818 12l-6.273 3.568z"/>
</svg>
);

const TAFIcon = () => (
<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
<path d="M9 11l3 3L22 4"></path>
<path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"></path>
</svg>
);

const MathText = ({ text }) => {
const ref = useRef(null);
useEffect(() => {
if (ref.current && window.renderMathInElement) {
renderMathInElement(ref.current, {
delimiters: [
{ left: "$$", right: "$$", display: true },
{ left: "$", right: "$", display: false }
],
throwOnError: false
});
}
}, [text]);
return <div ref={ref} className="whitespace-pre-line text-sm">{text}</div>;
};

const MathContent = ({ content }) => {
  if (typeof content === 'string') return <MathText text={content}/>;
  return (
    <>
      {Object.entries(content).map(([key,val])=>{
        if(key==='image'){
          if(val.src === 'pythagore.jpg'){
            return <img key={key} src={val.src} alt={val.alt} className="my-3 mx-auto rounded border w-1/2 h-auto"/>;
          }
          return <img key={key} src={val.src} alt={val.alt} className="my-3 mx-auto rounded border max-w-full"/>;
        }
        return <div key={key} className="mb-3"><MathText text={val}/></div>;
      })}
    </>
  );
};

const App = () => {
const [messages, setMessages] = useState([
{ type: 'bot', text: "Bonjour ! üëã\n\nChoisis un rappel de cours ou un exercice en cliquant sur les boutons ci-dessus ou ...\n\nüí° Astuce n¬∞1 : exemple: tape ¬´ cours 3 ¬ª pour acc√©der au rappel de cours sur le th√©or√®me de Pythagore (clique sur le bouton Menu pour voir la correspondance).\n\nüí° Astuce n¬∞2 : tu peux aussi taper un mot-cl√© comme ¬´ Pythagore ¬ª, ¬´ racine ¬ª, ¬´ pourcentage ¬ª.\n\nüìù Clique sur Solution pour obtenir la solution du dernier exercice cherch√©. Plusieurs exercices disponibles pour chaque th√®me.\n\nüéØ Mode TAF : Active le mode TAF pour r√©viser sp√©cifiquement le champ du test d'attentes fondamentales 2025-2026 !" }
]);
const [input, setInput] = useState('');
const [mathData, setMathData] = useState(null);
const [lastExercise, setLastExercise] = useState(null);
const [dark, setDark] = useState(false);
const [tafMode, setTafMode] = useState(false);
const endRef = useRef(null);
const chatScrollRef = useRef(null);

useEffect(() => { document.body.classList.toggle('dark', dark); }, [dark]);

// Charger le fichier JSON appropri√© selon le mode
useEffect(() => { 
  const filename = tafMode ? 'mathData3_enrichi_TAF.json' : 'mathData3.json';
  fetch(filename)
    .then(r => r.json())
    .then(data => {
      setMathData(data);
      setLastExercise(null); // R√©initialiser l'exercice en cours
    })
    .catch(err => {
      console.error('Erreur de chargement:', err);
      // Fallback sur mathData3.json si le fichier TAF n'est pas trouv√©
      if (tafMode) {
        fetch('mathData3.json').then(r=>r.json()).then(setMathData);
      }
    });
}, [tafMode]);

useEffect(() => { endRef.current?.scrollIntoView({ behavior: "smooth" }); }, [messages]);

if (!mathData) return null;

const generateExercise = (key) => {
const ex = mathData.themes[key].exercices;
return ex[Math.floor(Math.random()*ex.length)];
};

const analyze = (msg) => {
const m = msg.toLowerCase().trim();
if (m === 'menu') {
// Scroll vers le haut dans le conteneur de chat
setTimeout(() => {
  const chatScroll = document.getElementById('chat-scroll');
  if (chatScroll) {
    chatScroll.scrollTo({ top: 0, behavior: 'smooth' });
  }
}, 100);
return "üìö Th√®mes :\n\n" +
Object.values(mathData.themes).map((t,i)=>`${i+1}. ${t.nom}`).join('\n') +
"\n\n‚¨ÜÔ∏è Les boutons de cours et exercices sont disponibles en haut de la page.";
}
if (m.startsWith('cours')) {
const n = m.match(/cours (\d+)/);
if (n) {
const t = Object.values(mathData.themes)[n[1]-1];
return {
  title: t.nom,
  explanations: t.explanations
};
}
}
if (m.startsWith('exercice')) {
const n = m.match(/exercice (\d+)/);
if (n) {
const key = Object.keys(mathData.themes)[n[1]-1];
const t = mathData.themes[key];
const ex = generateExercise(key);
setLastExercise(ex);
return `‚úèÔ∏è Exercice (${t.nom})\n\n${ex.question}\n\nTape "solution"`;
}
}
const solutionKeywords = ['solution', 'solutions', 'soluce', 'soluces', 'solu', 'sol'];
if (lastExercise && solutionKeywords.includes(m)) {
return `‚úÖ ${lastExercise.reponse}`;
}
// üîç Recherche par mots-cl√©s
for (const theme of Object.values(mathData.themes)) {
  if (!theme.keywords) continue;
  for (const kw of theme.keywords) {
    if (m.includes(kw.toLowerCase())) {
      return {
        title: theme.nom,
        explanations: theme.explanations
      };
    }
  }
}
return "‚ùì";
};

const pushAction = (cmd) => {
const result = analyze(cmd);
if (result) {
setMessages(m => [...m, 
  { type: 'user', text: cmd }, 
  typeof result === 'string' ? { type:'bot', text: result } : { type:'bot', content: result }
]);
}
};

const send = () => {
if (!input.trim()) return;
pushAction(input);
setInput('');
};

const toggleTafMode = () => {
  setTafMode(prev => !prev);
  setMessages([
    { 
      type: 'bot', 
      text: !tafMode 
        ? "üéØ Mode TAF activ√© !\n\nTu as maintenant acc√®s aux exercices enrichis conformes au champ du test d'attentes fondamentales (TAF) de math√©matiques de 11e (2025-2026).\n\nNouveau contenu disponible :\n‚Ä¢ Puissances et racines carr√©es\n‚Ä¢ Divisibilit√© et nombres premiers\n‚Ä¢ Entiers relatifs\n‚Ä¢ Suites num√©riques\n‚Ä¢ Proportionnalit√© et √©chelles\n‚Ä¢ Calcul litt√©ral\n‚Ä¢ G√©om√©trie plane et solides\n‚Ä¢ Rep√©rage dans le plan\n‚Ä¢ Grandeurs et mesures\n‚Ä¢ Th√©or√®me de Pythagore\n\nüìö Clique sur Menu pour voir tous les th√®mes disponibles !" 
        : "üìò Mode Normal activ√© !\n\nTu es revenu au contenu standard. Choisis un th√®me pour commencer !"
    }
  ]);
};

return (
<>
<div id="chat-scroll" className="chat-bg">
<div className="max-w-4xl mx-auto">

<div className="card p-4 rounded-lg mb-3">
<div className="flex items-center justify-between">
<h1 className="text-xl font-bold flex items-center gap-2">
<CalculatorIcon/> Mon assistant de math√©matiques - niveau cycle d'orientation
</h1>
<span className={`mode-indicator ${tafMode ? 'mode-taf' : 'mode-normal'}`}>
{tafMode ? 'üéØ Mode TAF' : 'üìò Mode Normal'}
</span>
</div>
</div>

<div className="flex flex-wrap gap-2 mb-2">
{Object.values(mathData.themes).map((t,i)=>(
<button key={i}
onClick={()=>pushAction(`cours ${i+1}`)}
className="px-3 py-1 bg-blue-600 text-white rounded-full text-xs hover:bg-blue-700 transition">
Cours ‚Äî {t.nom}
</button>
))}
</div>

<div className="flex flex-wrap gap-2 mb-4">
{Object.values(mathData.themes).map((t,i)=>(
<button key={i}
onClick={()=>pushAction(`exercice ${i+1}`)}
className="px-3 py-1 bg-green-600 text-white rounded-full text-xs hover:bg-green-700 transition">
Exercice ‚Äî {t.nom}
</button>
))}
</div>

{messages.map((m,i)=>(
<div key={i} className={`flex mb-3 ${m.type==='user'?'justify-end':'justify-start'}`}>
<div className={`${m.type==='user'?'user-msg':'bot-msg'} px-4 py-3 rounded-lg max-w-md shadow`}>
{m.text && <MathText text={m.text}/>}
{m.content && <MathContent content={m.content.explanations || m.content}/>}
</div>
</div>
))}
<div ref={endRef}/>
</div>
</div>

<div id="input-bar" className="input-bar">
<div className="max-w-4xl mx-auto p-3">
{/* Premi√®re ligne : Menu, Solution, TAF, YouTube, Dark mode */}
<div className="flex items-center gap-2 mb-2 md:mb-0 flex-wrap md:flex-nowrap">
<button onClick={()=>pushAction('menu')}
className="px-4 py-2 bg-purple-600 text-white rounded-full text-sm hover:bg-purple-700 transition">
Menu
</button>

<button
onClick={()=>{ if (lastExercise) pushAction('solution'); }}
className="px-4 py-2 bg-yellow-400 text-black rounded-full text-sm font-semibold hover:bg-yellow-500 transition">
Solution
</button>

<button 
onClick={toggleTafMode}
className={`px-4 py-2 rounded-full text-sm font-semibold flex items-center gap-1 transition ${
  tafMode 
    ? 'bg-red-600 text-white hover:bg-red-700 taf-badge' 
    : 'bg-gray-200 text-gray-700 hover:bg-gray-300'
}`}>
<TAFIcon />
{tafMode ? 'TAF' : 'TAF'}
</button>

<button onClick={()=>window.open('https://www.youtube.com/@lesmaths1200','_blank')}
className="px-4 py-2 bg-red-600 text-white rounded-full text-sm hover:bg-red-700 transition">
YouTube
</button>

<button onClick={()=>setDark(d=>!d)}
className="px-3 py-2 rounded-full text-sm border hover:bg-gray-100 dark:hover:bg-gray-800 transition">
{dark?'‚òÄÔ∏è':'üåô'}
</button>

{/* Deuxi√®me ligne sur mobile : Input et bouton Envoyer - Sur desktop, tout sur une ligne */}
<div className="flex items-center gap-2 w-full md:w-auto md:flex-1">
<input value={input}
onChange={e=>setInput(e.target.value)}
onKeyDown={e=>e.key==='Enter' && send()}
placeholder="Fais ton choix"
className="flex-1 border rounded-lg px-3 py-2 text-sm"/>

<button onClick={send} className="bg-black text-white px-4 py-2 rounded-lg hover:bg-gray-800 transition">
<SendIcon/>
</button>
</div>
</div>
</div>
</div>
</>
);
};

ReactDOM.createRoot(document.getElementById('root')).render(<App />);
</script>
</body>
</html>
