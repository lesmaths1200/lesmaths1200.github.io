<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Assistant Math√©matiques Coll√®ge</title>

    <!-- React -->
    <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>

    <!-- Tailwind -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- KaTeX -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/katex.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/katex.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/contrib/auto-render.min.js"></script>

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html, body {
            height: 100%;
            width: 100%;
            overflow: hidden; /* on bloque le body */
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
        }

        #root {
            height: 100%;
        }

        .scroll-container {
            overflow-y: auto;
            scrollbar-width: none;
            -ms-overflow-style: none;
        }

        .scroll-container::-webkit-scrollbar {
            display: none;
        }

        .katex {
            font-size: 1.1em;
        }
    </style>
</head>

<body>
<div id="root"></div>

<script type="text/babel">
const { useState, useRef, useEffect } = React;

/* Icons */
const SendIcon = () => (
  <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
    <line x1="22" y1="2" x2="11" y2="13"></line>
    <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
  </svg>
);

const CalculatorIcon = ({ size = 20 }) => (
  <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
    <rect x="4" y="2" width="16" height="20" rx="2"></rect>
    <line x1="8" y1="6" x2="16" y2="6"></line>
  </svg>
);

const YoutubeIcon = ({ size = 16 }) => (
  <svg width={size} height={size} viewBox="0 0 24 24" fill="currentColor">
    <path d="M23.498 6.186a3.016 3.016 0 0 0-2.122-2.136C19.505 3.545 12 3.545 12 3.545s-7.505 0-9.377.505A3.017 3.017 0 0 0 .502 6.186C0 8.07 0 12 0 12s0 3.93.502 5.814a3.016 3.016 0 0 0 2.122 2.136c1.871.505 9.376.505 9.376.505s7.505 0 9.377-.505a3.015 3.015 0 0 0 2.122-2.136C24 15.93 24 12 24 12s0-3.93-.502-5.814z"/>
    <path d="M9.545 15.568V8.432L15.818 12l-6.273 3.568z"/>
  </svg>
);

/* Math rendering */
const MathText = ({ text }) => {
  const ref = useRef(null);

  useEffect(() => {
    if (ref.current && window.renderMathInElement) {
      renderMathInElement(ref.current, {
        delimiters: [
          { left: "$$", right: "$$", display: true },
          { left: "$", right: "$", display: false }
        ],
        throwOnError: false
      });
    }
  }, [text]);

  return <div ref={ref} className="whitespace-pre-line text-sm">{text}</div>;
};

const MathChatbot = () => {
  const [messages, setMessages] = useState([
    { type: "bot", text: "Bonjour ! üëã\nTape **menu** pour voir les th√®mes." }
  ]);
  const [input, setInput] = useState("");
  const [lastExercise, setLastExercise] = useState(null);
  const [mathData, setMathData] = useState(null);
  const [loading, setLoading] = useState(true);

  const messagesEndRef = useRef(null);
  const inputRef = useRef(null);

  /* Auto-scroll */
  useEffect(() => {
    messagesEndRef.current?.scrollIntoView({ behavior: "smooth" });
  }, [messages]);

  /* Auto-focus */
  useEffect(() => {
    inputRef.current?.focus();
  }, []);

  /* Load data */
  useEffect(() => {
    fetch("mathData2.json")
      .then(r => r.json())
      .then(d => {
        setMathData(d);
        setLoading(false);
      })
      .catch(() => setLoading(false));
  }, []);

  const handleSend = () => {
    if (!input.trim()) return;

    setMessages(m => [...m, { type: "user", text: input }]);
    setTimeout(() => {
      setMessages(m => [...m, { type: "bot", text: "ü§ñ R√©ponse en cours..." }]);
    }, 300);
    setInput("");
  };

  if (loading) {
    return (
      <div className="flex items-center justify-center h-full">
        <p>Chargement‚Ä¶</p>
      </div>
    );
  }

  return (
    <div style={{ height: "100dvh", display: "flex", flexDirection: "column" }}>

      {/* ZONE SCROLLABLE */}
      <div
        className="scroll-container bg-gray-50"
        style={{ flex: 1, paddingBottom: "96px" }}
      >
        <div className="p-4 max-w-4xl mx-auto">

          <div className="bg-black text-white p-4 rounded-lg mb-4 shadow">
            <h1 className="text-xl font-bold flex items-center gap-2">
              <CalculatorIcon size={24} />
              Maths Coll√®ge
            </h1>
            <p className="text-xs text-gray-300">Assistant p√©dagogique</p>
          </div>

          {messages.map((msg, i) => (
            <div
              key={i}
              className={`flex mb-4 ${msg.type === "user" ? "justify-end" : "justify-start"}`}
            >
              <div
                className={`max-w-md px-4 py-3 rounded-lg shadow text-sm
                  ${msg.type === "user"
                    ? "bg-black text-white"
                    : "bg-white border text-gray-800"}`}
              >
                <MathText text={msg.text} />
              </div>
            </div>
          ))}

          <div ref={messagesEndRef} />
        </div>
      </div>

      {/* BARRE FIXE */}
      <div
        className="bg-white border-t"
        style={{
          position: "fixed",
          bottom: 0,
          left: 0,
          width: "100%",
          zIndex: 50,
          boxShadow: "0 -2px 10px rgba(0,0,0,0.1)"
        }}
      >
        <div className="max-w-4xl mx-auto p-3 flex gap-2">
          <input
            ref={inputRef}
            type="text"
            value={input}
            onChange={e => setInput(e.target.value)}
            onKeyDown={e => e.key === "Enter" && handleSend()}
            placeholder="Pose ta question‚Ä¶"
            className="flex-1 px-3 py-2 border rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-black"
          />
          <button
            onClick={handleSend}
            className="px-4 py-2 bg-black text-white rounded-lg hover:bg-gray-800"
          >
            <SendIcon />
          </button>
        </div>
      </div>

    </div>
  );
};

ReactDOM.createRoot(document.getElementById("root")).render(<MathChatbot />);
</script>
</body>
</html>