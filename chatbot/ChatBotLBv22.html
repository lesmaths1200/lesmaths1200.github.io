<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Assistant Math√©matiques Coll√®ge</title>

<!-- React -->
<script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
<script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>

<!-- Tailwind -->
<script src="https://cdn.tailwindcss.com"></script>

<!-- KaTeX -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/katex.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/katex.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/contrib/auto-render.min.js"></script>

<style>
* { box-sizing: border-box; margin: 0; padding: 0; }

html, body {
  height: 100%;
  overflow: hidden;
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
}

/* ---------- TH√àMES ---------- */
body { background: #f9fafb; color: #111827; }
body.dark { background: #0f172a; color: #e5e7eb; }

.chat-bg { background: inherit; }
.card, .bot-msg { background: #fff; border: 1px solid #e5e7eb; }
.user-msg { background: #000; color: #fff; }

body.dark .card,
body.dark .bot-msg,
body.dark .input-bar {
  background: #020617;
  border-color: #1e293b;
}

body.dark input {
  background: #020617;
  color: #e5e7eb;
  border-color: #1e293b;
}

/* ---------- SCROLL ZONE ---------- */
#chat-scroll {
  position: absolute;
  inset: 0 0 72px 0;
  overflow-y: auto;
  padding: 16px;
}

#chat-scroll::-webkit-scrollbar { width: 8px; }
#chat-scroll::-webkit-scrollbar-thumb {
  background: #9ca3af;
  border-radius: 4px;
}
body.dark #chat-scroll::-webkit-scrollbar-thumb {
  background: #475569;
}

/* ---------- INPUT BAR ---------- */
#input-bar {
  position: fixed;
  bottom: 0;
  left: 0;
  right: 0;
  height: 72px;
  z-index: 100;
  background: #fff;
  border-top: 1px solid #e5e7eb;
}

/* ---------- SCROLL TO BOTTOM ---------- */
#scroll-btn {
  position: fixed;
  right: 20px;
  bottom: 92px;
  width: 44px;
  height: 44px;
  border-radius: 50%;
  background: #111827;
  color: white;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  box-shadow: 0 4px 12px rgba(0,0,0,0.3);
  z-index: 200;
}

#scroll-btn.hidden {
  opacity: 0;
  pointer-events: none;
}

body.dark #scroll-btn {
  background: #e5e7eb;
  color: #020617;
}

.katex { font-size: 1.1em; }
</style>
</head>

<body>
<div id="root"></div>

<script type="text/babel">
const { useState, useEffect, useRef } = React;

const SendIcon = () => (
<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
<line x1="22" y1="2" x2="11" y2="13"></line>
<polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
</svg>
);

const YoutubeIcon = () => (
<svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor">
<path d="M23.498 6.186a3.016 3.016 0 0 0-2.122-2.136C19.505 3.545 12 3.545 12 3.545s-7.505 0-9.377.505A3.017 3.017 0 0 0 .502 6.186C0 8.07 0 12 0 12s0 3.93.502 5.814a3.016 3.016 0 0 0 2.122 2.136c1.871.505 9.376.505 9.376.505s7.505 0 9.377-.505a3.015 3.015 0 0 0 2.122-2.136C24 15.93 24 12 24 12s0-3.93-.502-5.814z"/>
<path d="M9.545 15.568V8.432L15.818 12l-6.273 3.568z"/>
</svg>
);

const MathText = ({ text }) => {
const ref = useRef(null);
useEffect(() => {
if (ref.current && window.renderMathInElement) {
renderMathInElement(ref.current, {
delimiters: [
{ left: "$$", right: "$$", display: true },
{ left: "$", right: "$", display: false }
],
throwOnError: false
});
}
}, [text]);
return <div ref={ref} className="whitespace-pre-line text-sm">{text}</div>;
};

const App = () => {
const [messages, setMessages] = useState([
{ type: 'bot', text: "Bonjour ! üëã\nTape **menu** pour voir les th√®mes." }
]);
const [input, setInput] = useState('');
const [dark, setDark] = useState(false);
const [showScrollBtn, setShowScrollBtn] = useState(false);
const scrollRef = useRef(null);
const endRef = useRef(null);

useEffect(() => {
document.body.classList.toggle('dark', dark);
}, [dark]);

useEffect(() => {
endRef.current?.scrollIntoView({ behavior: "smooth" });
}, [messages]);

useEffect(() => {
const el = scrollRef.current;
if (!el) return;
const onScroll = () => {
const atBottom = el.scrollHeight - el.scrollTop - el.clientHeight < 80;
setShowScrollBtn(!atBottom);
};
el.addEventListener('scroll', onScroll);
onScroll();
return () => el.removeEventListener('scroll', onScroll);
}, []);

const send = () => {
if (!input.trim()) return;
setMessages(m => [...m, { type: 'user', text: input }]);
setMessages(m => [...m, { type: 'bot', text: "R√©ponse simul√©e." }]);
setInput('');
};

return (
<>
<div id="chat-scroll" ref={scrollRef} className="chat-bg">
<div className="max-w-4xl mx-auto">

{/* BOUTONS DU HAUT */}
<div className="card p-3 rounded-lg mb-4 text-center">
<button onClick={()=>setInput('menu')}
className="px-4 py-2 bg-purple-600 text-white rounded-full text-sm mr-2">
Menu
</button>
<button onClick={()=>window.open('https://www.youtube.com/@lesmaths1200','_blank')}
className="px-4 py-2 bg-red-600 text-white rounded-full text-sm inline-flex items-center gap-2">
<YoutubeIcon/> YouTube
</button>
</div>

{messages.map((m,i)=>(
<div key={i} className={`flex mb-3 ${m.type==='user'?'justify-end':'justify-start'}`}>
<div className={`${m.type==='user'?'user-msg':'bot-msg'} px-4 py-3 rounded-lg max-w-md shadow`}>
<MathText text={m.text}/>
</div>
</div>
))}

<div ref={endRef}/>
</div>
</div>

<div id="scroll-btn" className={showScrollBtn ? '' : 'hidden'}
onClick={()=>scrollRef.current.scrollTo({top: scrollRef.current.scrollHeight, behavior:'smooth'})}>
‚Üì
</div>

<div id="input-bar" className="input-bar">
<div className="max-w-4xl mx-auto p-3 flex items-center gap-2">
<button onClick={()=>setInput('menu')}
className="px-4 py-2 bg-purple-600 text-white rounded-full text-sm">
Menu
</button>
<button onClick={()=>window.open('https://www.youtube.com/@lesmaths1200','_blank')}
className="px-4 py-2 bg-red-600 text-white rounded-full text-sm inline-flex items-center gap-2">
<YoutubeIcon/> YouTube
</button>
<button onClick={()=>setDark(d=>!d)}
className="px-3 py-2 rounded-full text-sm border">
{dark ? '‚òÄÔ∏è' : 'üåô'}
</button>

<input value={input}
onChange={e=>setInput(e.target.value)}
onKeyDown={e=>e.key==='Enter' && send()}
placeholder="Pose ta question‚Ä¶"
className="flex-1 border rounded-lg px-3 py-2 text-sm"/>

<button onClick={send}
className="bg-black text-white px-4 py-2 rounded-lg">
<SendIcon/>
</button>
</div>
</div>
</>
);
};

ReactDOM.createRoot(document.getElementById('root')).render(<App />);
</script>
</body>
</html>